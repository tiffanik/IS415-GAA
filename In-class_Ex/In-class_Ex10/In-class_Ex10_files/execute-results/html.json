{
  "hash": "a1b6f869d912eb5ad474f96672449e32",
  "result": {
    "markdown": "---\ntitle: \"In-class_Ex10  :Spatial Interaction Models\"\n---\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sf, spdep, GWmodel, SpatialML, tidyverse,\n               tmap, ggpubr, olsrr, devtools, rsample)\n```\n:::\n\n\n## Data Import and Prepatation\n\n### Importing geospatial data into R environment\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmdata <- read_rds(\"data/aspatial/mdata.rds\")\nsubzone <- st_read(dsn = \"data/geospatial\", \n                   layer = \"MP14_SUBZONE_WEB_PL\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `MP14_SUBZONE_WEB_PL' from data source \n  `C:\\tiffanik\\IS415-GAA\\In-class_Ex\\In-class_Ex10\\data\\geospatial' \n  using driver `ESRI Shapefile'\nSimple feature collection with 323 features and 15 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 2667.538 ymin: 15748.72 xmax: 56396.44 ymax: 50256.33\nProjected CRS: SVY21\n```\n:::\n\n```{.r .cell-code}\nset.seed(123)\n\nreasale_split <- initial_split(mdata,\n                               prop = 6.5/10,)\ntrain_data <- training(reasale_split)\ntest_data <- testing(reasale_split)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(train_data, \"data/model/train_data.rds\")\nwrite_rds(test_data, \"data/model/test_data.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nprice_mlr <- lm(resale_price ~ floor_area_sqm +\n                storey_order + remaining_lease_mths +\n                PROX_CBD + PROX_ELDERLYCARE + PROX_HAWKER +\n                PROX_MRT + PROX_PARK + PROX_MALL +\n                PROX_SUPERMARKET + WITHIN_350M_KINDERGARTEN +\n                WITHIN_350M_CHILDCARE + WITHIN_350M_BUS +\n                WITHIN_1KM_PRISCH, \n                data=train_data)\nsummary(price_mlr)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = resale_price ~ floor_area_sqm + storey_order + remaining_lease_mths + \n    PROX_CBD + PROX_ELDERLYCARE + PROX_HAWKER + PROX_MRT + PROX_PARK + \n    PROX_MALL + PROX_SUPERMARKET + WITHIN_350M_KINDERGARTEN + \n    WITHIN_350M_CHILDCARE + WITHIN_350M_BUS + WITHIN_1KM_PRISCH, \n    data = train_data)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-208178  -39039    -772   36332  329325 \n\nCoefficients:\n                           Estimate Std. Error t value Pr(>|t|)    \n(Intercept)              116830.933  10760.893  10.857  < 2e-16 ***\nfloor_area_sqm             2705.890     90.923  29.760  < 2e-16 ***\nstorey_order              14348.939    337.874  42.468  < 2e-16 ***\nremaining_lease_mths        344.750      4.589  75.126  < 2e-16 ***\nPROX_CBD                 -17283.072    200.215 -86.322  < 2e-16 ***\nPROX_ELDERLYCARE         -13474.524    988.563 -13.630  < 2e-16 ***\nPROX_HAWKER              -19645.238   1279.857 -15.350  < 2e-16 ***\nPROX_MRT                 -33962.996   1730.546 -19.626  < 2e-16 ***\nPROX_PARK                 -3640.042   1472.340  -2.472   0.0134 *  \nPROX_MALL                -16608.047   2039.173  -8.145 4.25e-16 ***\nPROX_SUPERMARKET         -22537.436   4137.722  -5.447 5.25e-08 ***\nWITHIN_350M_KINDERGARTEN   8065.517    640.654  12.589  < 2e-16 ***\nWITHIN_350M_CHILDCARE     -4150.670    353.500 -11.742  < 2e-16 ***\nWITHIN_350M_BUS             976.494    222.816   4.383 1.18e-05 ***\nWITHIN_1KM_PRISCH         -8478.903    485.094 -17.479  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 61390 on 10320 degrees of freedom\nMultiple R-squared:  0.7427,\tAdjusted R-squared:  0.7424 \nF-statistic:  2128 on 14 and 10320 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(price_mlr,\"data/model/price_mlr.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntrain_data_sp <- as_Spatial(train_data)\ntrain_data_sp\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nclass       : SpatialPointsDataFrame \nfeatures    : 10335 \nextent      : 11597.31, 42623.63, 28217.39, 48741.06  (xmin, xmax, ymin, ymax)\ncrs         : +proj=tmerc +lat_0=1.36666666666667 +lon_0=103.833333333333 +k=1 +x_0=28001.642 +y_0=38744.572 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \nvariables   : 17\nnames       : resale_price, floor_area_sqm, storey_order, remaining_lease_mths,          PROX_CBD,     PROX_ELDERLYCARE,        PROX_HAWKER,           PROX_MRT,          PROX_PARK,   PROX_GOOD_PRISCH,        PROX_MALL,            PROX_CHAS,     PROX_SUPERMARKET, WITHIN_350M_KINDERGARTEN, WITHIN_350M_CHILDCARE, ... \nmin values  :       230000,             74,            1,                  546, 0.999393538715878, 1.98943787433087e-08, 0.0333358643817954, 0.0220407324774434, 0.0441643212802781, 0.0907500295577619,                0, 6.20621206270077e-09, 1.21715176356525e-07,                        0,                     0, ... \nmax values  :      1186888,            138,           17,                 1164,   19.632402730488,     3.30163731686804,   2.86763031236184,   2.13060636038504,   2.41313695915468,   10.6169590126272, 2.27100643784442,    0.808332738794272,     1.53786629004208,                        7,                    20, ... \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncoords <- st_coordinates(mdata)\ncoords_train <- st_coordinates(train_data)\ncoords_test <- st_coordinates(test_data)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncoords_train <- write_rds (coords_train,\"data/model/coords_train.rds\")\ncoords_test <- write_rds(coords_test,\"data/model/coords_test.rds\" )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#First, we will drop geometry column of the sf data.frame by using \n#st_drop_geometry() #of sf package.\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntrain_data <- train_data %>% st_drop_geometry()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234) # random forest\nrf <- ranger(resale_price ~ floor_area_sqm +\n                storey_order + remaining_lease_mths +\n                PROX_CBD + PROX_ELDERLYCARE + PROX_HAWKER +\n                PROX_MRT + PROX_PARK + PROX_MALL +\n                PROX_SUPERMARKET + WITHIN_350M_KINDERGARTEN +\n                WITHIN_350M_CHILDCARE + WITHIN_350M_BUS +\n                WITHIN_1KM_PRISCH, \n                data=train_data)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nprint(rf)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRanger result\n\nCall:\n ranger(resale_price ~ floor_area_sqm + storey_order + remaining_lease_mths +      PROX_CBD + PROX_ELDERLYCARE + PROX_HAWKER + PROX_MRT + PROX_PARK +      PROX_MALL + PROX_SUPERMARKET + WITHIN_350M_KINDERGARTEN +      WITHIN_350M_CHILDCARE + WITHIN_350M_BUS + WITHIN_1KM_PRISCH,      data = train_data) \n\nType:                             Regression \nNumber of trees:                  500 \nSample size:                      10335 \nNumber of independent variables:  14 \nMtry:                             3 \nTarget node size:                 5 \nVariable importance mode:         none \nSplitrule:                        variance \nOOB prediction error (MSE):       692845626 \nR squared (OOB):                  0.9526329 \n```\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\ngwRF_adavtive$Glocal.Model$variable.importance\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}